/**
 * jquery.slidestep - Slidestep ui control in jQuery
 * 
 * Written by
 * Cristobal Dabed (cristobal@dabed.org)
 *
 * Licensed under the MIT (MIT-LICENSE.txt).
 *
 * @author Cristobal Dabed
 * @version 0.1
 */
(function(){function r(){function u(e,t){var n=-1;for(var i=r.length;i--;)if(r[i][t]==e){n=i;break}return n}function a(t,n,i){if(r.length===0)return null;e(i)&&(i=!0);if(!o[n])return f(t,n,i);var s=0,u=r.length-1,a=r[s][n],l=r[u][n],c=(l-a)/u;if(t>=l)s=u;else if(t>a){s=Math.round((t-a)/c);if(!i){var h=t-r[s-1][n],p=r[s][n]-t;h===p&&s--}}return r[s]}function f(e,t,n){var i=0,s=r.length-1,o=r[i][t],u=r[s][t];if(e>=u)i=s;else if(e>o){var a,f;for(;s--;){o=r[s][t];if(e>=o&&e<=u){a=e-o;f=u-e;n?i=s+(a<f?0:1):i=s+(a<=f?0:1);break}u=o}}return r[i]}function l(e){var t=new Array(r.length),n=e==="all";for(var i=r.length;i--;)n?t[i]={prc:r[i].prc,val:r[i].val}:t[i]=r[i][e];return t}var r=[],i={},s={},o={prc:!0,val:!0};return{build:function(e,u,a){var f=n(e,u,a),l=0,c=100,h=t(c,f.length),p=n(l,c,h);p.length<f.length&&p.push(c);i={};s={};r=new Array(p.length);for(l=r.length;l--;){r[l]={prc:p[l],val:f[l]};i[f[l]]=p[l];s[p[l]]=f[l]}o.prc=!0;o.val=!0},values:function(){return l("val")},prcs:function(){return l("prc")},items:function(){return l("all")},setItems:function(e){o.prc=!0;o.val=!0;i={};s={};r=new Array(e.length);var t,n,u,a,f,l=0,c={},h=0,p={};for(t=r.length;t--;){n=e[t].prc;u=e[t].val;r[t]={prc:n,val:u};i[u]=n;s[n]=u;if(a&&o.prc){a-=n;if(!c[a]){l++;c[a]=!0}}if(f&&o.val){f-=u;if(!p[f]){h++;p[f]=!0}}a=n;f=u}o.prc=l<=1;o.val=h<=1},findVal:function(e,t){var n=a(e,"prc",t);return n?n.val:null},findValByPrc:function(e){return s.hasOwnProperty(e)?s[e]:null},findIndexByPrc:function(e){return u(e,"prc")},findPrc:function(e,t){var n=a(e,"val",t);return n?n.prc:null},findPrcByVal:function(e){return i.hasOwnProperty(e)?i[e]:null},findIndexByVal:function(e){return u(e,"val")}}}var e=function(e){return typeof e=="undefined"},t=function(e,t){return Math.round(e/(t-1))},n=function(t,n,r){e(r)&&(r=1);var i=[];for(var s=t;s<=n;s+=r)i.push(s);return i};window.Set=r})();(function(e){function o(o,u,a){function m(e,t){f[e]&&f[e](t)}function g(t){if(h!=t){var r=n(t,e(u).width());f.usePercentage?e(o).css("left",r+"%"):e(o).css("left",t+"px");m("onChange",{event:d,left:t,prc:p});p=r;h=t}}function y(t){c||m("onStart",{event:t,left:h,prc:p});c=!0;if(i){var n=t.originalEvent,r=e(o).position();v={x:n.changedTouches[0].pageX-r.left}}d=t}function b(e){c&&m("onEnd",{event:d,left:h,prc:p});c=!1;d=null;v=null}function w(t){if(i)return E(t);if(!c||!d)return;var n=d.pageX-t.pageX,r=0,s=e(u).width(),a=e(o).position().left;a-=n;a<r?a=r:a>s&&(a=s);g(a);d=t}function E(t){if(!c||!t)return!0;var n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],r=n.pageX-v.x,i=0,s=e(u).width();r<i?r=i:r>s&&(r=s);g(r);d=t;return!1}var f=jQuery.extend({},r,a),l={},c=!1,h=e(o).position().left,p=n(h,e(u).width()),d=null,v=null;return{enabled:function(n){if(t(n))return l.enabled;if(n&&!l.enabled){e(o).on(s.down,y);e(o).on(s.up,b);e(o).on(s.move,w);e(o).on(s.cancel,b);e(document).on(s.up,b);e(document).on(s.move,w)}else{e(o).off(s.down,y);e(o).off(s.up,b);e(o).off(s.move,w);e(o).off(s.cancel,handleMouseCancel);e(document).off(s.up,b);e(document).off(s.move,w)}l.enabled=n},dragging:function(){return c},destroy:function(){this.enabled(!1);l=null;d=null;v=null}}}var t=function(e){return typeof e=="undefined"},n=function(e,t){return 100*e/t},r={usePercentage:!0,onStart:e.noop,onChange:e.noop,onEnd:e.noop},i=/android|iphone|ipad|mobile/i.test(navigator.userAgent),s={click:i?"touchstart":"click",down:i?"touchstart":"mousedown",move:i?"touchmove":"mousemove",up:i?"touchend":"mouseup",cancel:"touchcancel"};o.defaults=r;window.Draggable=o})(jQuery);(function(e){function a(s,o){function b(){h=e.extend({},a.defaults,o);e(s).addClass("slidestep").append(a.template);c=e(s).find(".rail").get(0);l=e(s).find(".rail .handle").get(0);e(l).addClass("unselectable").attr("unselectable","on");d=new Draggable(l,c,{onEnd:H});e.each(["adjustOffset","items","grid","log","draggable","slideOnClick"],function(e,t){h.hasOwnProperty(t)&&f.set(t,h[t])});O(h.value);e(s).data("slidestep",f)}function w(){if(h.log&&u)try{console.log.apply(console,arguments)}catch(e){}}function E(e,t){if(h[e]&&r(h[e],"function"))return h[e](t);return}function S(e,t){h[e]=t}function x(t){if(t==="options")return e.extend({},h);if(!h.hasOwnProperty(t))return null;var n=h[t];r(n,"object")&&!r(n.concat,"function")&&(n=e.extend({},n));return n}function T(e,n,r){if(t(n))return f.get(e);S(e,n);t(r)&&(r=!0);if(r){f.setItems(p);f.grid()&&f.grid(!0)}return}function N(n,r,i){w("moveTo",n,r,i);var s=null,o={val:r,prc:n,index:g.findIndexByPrc(n)},u=e.extend({},o),a={pos:u,lastPos:v,magnetize:y,animate:i};if(y){if(a.lastPos){i=a.lastPos.index!=a.pos.index;a.animate=i}s=E("getAnimateOptions",a);t(s)&&i&&(s=e.extend({},h.magnetizeOptions));s||(i=!1)}else if(i){s=E("getAnimateOptions",a);t(s)&&i&&(s=e.extend({},h.slideOptions));s||(i=!1)}i?e(l).animate({left:n+"%"},s):e(l).css("left",n+"%");S("prc",n);S("value",r);E("onChange",{pos:u});v=o}function C(e,t){w("moveToPrc",e);var n=g.findVal(e);e=g.findPrcByVal(n);N(e,n,t)}function k(e,t){w("moveToVal",e);var n=g.findPrc(e);e=g.findValByPrc(n);N(n,e,t)}function L(e,t){N(e,t,!1)}function A(e){C(e,!1)}function O(e){k(e,!1)}function M(e,t){N(e,t,!0)}function _(e){C(e,!0)}function D(e){k(e,!0)}function P(n){if(n.target===l||!n)return;var r=n.offsetX;t(r)&&(r=n.clientX-e(s).offset().left);var o=i.val2prc(r,e(s).width());E("onSlide",{prc:o,val:x("val")});_(o)}function H(e){if(h.magnetize){y=!0;C(e.prc,!1);y=!1}}var f=null,l=null,c=null,h=null,p=null,d=null,v=null,m={},g=new Set,y=!1;f={set:function(e,t){if(e in f&&r(f[e],"function"))f[e](t);else if(e==="options"&&r(t,"object"))for(e in t)f.set(e,t[e])},get:function(e){return x(e)},log:function(e){return T("log",e,!1)},min:function(e){return T("min",e)},max:function(e){return T("max",e)},step:function(e){return T("step",e)},value:function(e){var n="value";if(t(e))return f.get(n);var i=!0,s=e;if(r(e,"object")){i=e.slide;s=e.value}i?D(s):O(s);S(n)},val:this.value,prc:function(e){var n="prc";if(t(e))return f.get(n);var i=!0,s=e;if(r(e,"object")){i=e.slide;s=e.value}i?_(s):A(s)},items:function(e){var i="items";if(t(e))return f.get(i);var s,o,u=x("min"),a=x("max"),l=x("step"),c=e,h=!0;if(c&&c.length>1)try{h=r(c[0],"object");if(!h){s=s=c.length;o=(s-1)*l;for(;s--;){c[s]={prc:c[s],val:o};o-=l}}if(c[0].prc!==0||c[c.length-1].prc!==100){w("prcs goes from 0..100 from the first object to the last object");c=null}}catch(d){w("failed to build with given set of items")}if(c){g.setItems(c);if(h){p=new Array(c.length);for(s=c.length;n--;)p[s]={prc:c[s].prc,val:c[s].val}}else p=e.concat()}else{g.build(u,a,l);p=null}S(i,g.items());f.grid()&&f.grid(!0);return},grid:function(n){var r="grid";if(t(n))return f.get(r);e(s).find(".grid").remove();if(n){e(s).prepend('<div class="grid"></div>');var o=e(s).find(".grid"),u=function(e,t){return'<div class="'+e+'" style="position: absolute; left: '+t+'%"></div>'},a=f.adjustOffset()?e(l).width():0;o.css("right",a+"px");a=i.val2prc(e(l).width(),e(c).width())/2;e.each(g.items(),function(e,t){o.append(u("col",t.prc)).append(u("marker",t.prc+a))})}S(r,n);return},draggable:function(e){return d.enabled(e)},adjustOffset:function(n){var r="adjustOffset";if(t(n))return f.get(r);var i=n?e(l).width():0;e(c).css("right",i+"px");f.grid()&&f.grid(!0);S(r,n);return},magnetize:function(e){return T("magnetize",e,!1)},slideOnClick:function(n){var r="slideOnClick";if(t(n))return f.get(r);n&&!m[r]?e(s).on("click",P):m[r]&&e(s).off("click",P);m[r]=n;S(r,n);return},destroy:function(){e(s).data("slidestep",null);d.destroy();f.slideOnClick(!1);e(s).removeClass("slidestep");e(s).find(".rail").remove();e(s).find(".grid").remove();l=null;c=null;h=null;p=null;d=null;m=null;g=null;f=null}};b()}var t=function(e){return typeof e=="undefined"},r=function(e,t){return typeof e===t},i={};i.val2prc=function(e,t){return 100*e/t};i.prc2val=function(e,t){return e*t/100};var s={log:!1,grid:!1,min:0,max:100,step:1,value:0,items:null,draggable:!0,adjustOffset:!0,slideOnClick:!1,magnetize:!1,slideOptions:{easing:"swing",duration:400},magnetizeOptions:{easing:"linear",duration:100},getAnimateOptions:e.noop,onSlide:e.noop,onStart:e.noop,onChange:e.noop},o='<div class="rail"><a class="handle"></a></div>',u="console"in window;a.defaults=s;a.template=o;window.Slidestep=a;e.fn.slidestep=function(t){return this.each(function(){e(this).data("slidestep")?e(this).data("slidestep").set.apply(t,Array.prototype.slice.call(arguments,1)):new a(this,t)})}})(jQuery);