/**
 * jquery.slidestep - Slidestep ui control in jQuery
 * 
 * Written by
 * Cristobal Dabed (cristobal@dabed.org)
 *
 * Licensed under the MIT (MIT-LICENSE.txt).
 *
 * @author Cristobal Dabed
 * @version 0.1
 * 
 * Dependencies
 *  - jQuery 1.7 >= (http://jquery.com)
 **/
(function(){function r(){function u(e,t){var n=-1;for(var i=r.length;i--;)if(r[i][t]==e){n=i;break}return n}function a(t,n,i){if(r.length===0)return null;e(i)&&(i=!0);if(!o[n])return f(t,n,i);var s=0,u=r.length-1,a=r[s][n],l=r[u][n],c=(l-a)/u;if(t>=l)s=u;else if(t>a){s=Math.round((t-a)/c);if(!i){var h=t-r[s-1][n],p=r[s][n]-t;h===p&&s--}}return r[s]}function f(e,t,n){var i=0,s=r.length-1,o=r[i][t],u=r[s][t];if(e>=u)i=s;else if(e>o){var a,f;for(;s--;){o=r[s][t];if(e>=o&&e<=u){a=e-o;f=u-e;n?i=s+(a<f?0:1):i=s+(a<=f?0:1);break}u=o}}return r[i]}function l(e){var t=new Array(r.length),n=e==="all";for(var i=r.length;i--;)n?t[i]={prc:r[i].prc,val:r[i].val}:t[i]=r[i][e];return t}var r=[],i={},s={},o={prc:!0,val:!0};return{build:function(e,u,a){var f=n(e,u,a),l=0,c=100,h=t(c,f.length),p=n(l,c,h);p.length<f.length&&p.push(c);i={};s={};r=new Array(p.length);for(l=r.length;l--;){r[l]={prc:p[l],val:f[l]};i[f[l]]=p[l];s[p[l]]=f[l]}o.prc=!0;o.val=!0},values:function(){return l("val")},prcs:function(){return l("prc")},items:function(){return l("all")},setItems:function(e){o.prc=!0;o.val=!0;i={};s={};r=new Array(e.length);var t,n,u,a,f,l=0,c={},h=0,p={};for(t=r.length;t--;){n=e[t].prc;u=e[t].val;r[t]={prc:n,val:u};i[u]=n;s[n]=u;if(a&&o.prc){a-=n;if(!c[a]){l++;c[a]=!0}}if(f&&o.val){f-=u;if(!p[f]){h++;p[f]=!0}}a=n;f=u}o.prc=l<=1;o.val=h<=1},findVal:function(e,t){var n=a(e,"prc",t);return n?n.val:null},findValByPrc:function(e){return s.hasOwnProperty(e)?s[e]:null},findIndexByPrc:function(e){return u(e,"prc")},findPrc:function(e,t){var n=a(e,"val",t);return n?n.prc:null},findPrcByVal:function(e){return i.hasOwnProperty(e)?i[e]:null},findIndexByVal:function(e){return u(e,"val")}}}var e=function(e){return typeof e=="undefined"},t=function(e,t){return Math.round(e/(t-1))},n=function(t,n,r){e(r)&&(r=1);var i=[];for(var s=t;s<=n;s+=r)i.push(s);return i};window.Set=r})();(function(e){function u(u,a,f){function x(t){var n=o[t];if(l[n]){var r={event:event,pos:e.extend({},d)};l[n](r)}}function T(t,r){if(d.x!=t){var i=n(t,e(a).width()),s=0;l.usePercentage?e(u).css("left",i+"%"):e(u).css("left",t+"px");d.y=r;d.x=t;d.prcX=i;d.prcY=s;x("change");return!0}return!1}function N(r){if(h)return;var s=0,o=0,f=e(u).offset(),c=e(u).position();if(i){var g=r.originalEvent.changedTouches[0],b=e(u).width(),T=e(u).height();s=g.clientX-f.left;if(t(s)||s>b||s<0)s=b/2;o=g.clientX-f.top;if(t(o)||o>T||o<0)o=T/2;v.x=g.pageX-c.left;v.y=g.pageY-c.top}else{s=r.offsetX;t(f.x)&&(s=r.clientX-f.left);o=r.offsetY;t(o)&&(o=r.clientY-f.top)}p.x=s;p.y=o;d.x=c.left;d.y=c.top;d.prcX=n(d.x,e(a).width());d.prcY=n(d.y,e(a).height());y=e(a).width();w=e(a).height();E=l.adjustOffset?p.x:0;S=l.adjustOffset?p.y:0;m=r;x("start");h=!0;return!1}function C(e){h&&x("end");h=!1;m=null}function k(t){if(!h||!m||!t)return!0;var n=0,r=0;if(i){var s=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];n=s.pageX-(v.x+E)}else{var o=e(a).offset();n=t.clientX-(o.left+E)}n<g?n=g:n>y&&(n=y);m=t;if(T(n,r)){y=e(a).width();w=e(a).height()}return!1}var l=jQuery.extend({},r,f),c={},h=!1,p={x:0,y:0},d={x:0,y:0,prcX:0,prxY:0},v={x:0,y:0},m=null,g=0,y=0,b=0,w=0,E=0,S=0;return{enabled:function(n){if(t(n))return c.enabled;if(n&&!c.enabled){e(u).on(s.down,N);e(u).on(s.up,C);e(u).on(s.move,k);e(u).on(s.cancel,C);e(document).on(s.up,C);e(document).on(s.move,k)}else{e(u).off(s.down,N);e(u).off(s.up,C);e(u).off(s.move,k);e(u).off(s.cancel,handleMouseCancel);e(document).off(s.up,C);e(document).off(s.move,k)}c.enabled=n},dragging:function(){return h},destroy:function(){this.enabled(!1);c=null;d=null;p=null;v=null;m=null}}}var t=function(e){return typeof e=="undefined"},n=function(e,t){return 100*e/t},r={adjustOffset:!0,usePercentage:!0,updatePos:!0,onStart:e.noop,onChange:e.noop,onEnd:e.noop},i=/android|iphone|ipad|mobile/i.test(navigator.userAgent),s={click:i?"touchstart":"click",down:i?"touchstart":"mousedown",move:i?"touchmove":"mousemove",up:i?"touchend":"mouseup",cancel:"touchcancel"},o={change:"onChange",start:"onStart",end:"onEnd"};u.defaults=r;window.Draggable=u})(jQuery);(function(e){function a(s,o){function x(){h=e.extend({},a.defaults,o);e(s).addClass("slidestep").append(a.template);c=e(s).find(".rail").get(0);l=e(s).find(".rail .handle").get(0);e(l).addClass("unselectable").attr("unselectable","on");d=new Draggable(l,c,{onChange:R,onStart:q,onEnd:U});e.each(["adjustOffset","items","grid","log","draggable","slideOnClick"],function(e,t){h.hasOwnProperty(t)&&f.set(t,h[t])});H(h.value);e(s).data("slidestep",f)}function T(){if(h.log&&u)try{console.log.apply(console,arguments)}catch(e){}}function N(e,t){if(h[e]&&r(h[e],"function"))return h[e](t);return}function C(e,t){h[e]=t}function k(t){if(t==="options")return e.extend({},h);if(!h.hasOwnProperty(t))return null;var n=h[t];r(n,"object")&&!r(n.concat,"function")&&(n=e.extend({},n));return n}function L(e,n,r){if(t(n))return f.get(e);C(e,n);t(r)&&(r=!0);if(r){f.setItems(p);f.grid()&&f.grid(!0)}return}function A(n,r,i){t(i)&&(i=!0);var s={pos:r,lastPos:v};i&&(s.pos=e.extend({},s.pos));N(S[n],s);i&&(v=r)}function O(n,r,i){T("moveTo",n,r,i);var s=null,o={val:r,prc:n,index:b.findIndexByPrc(n)},u={val:r,prc:n,index:o.index},a={pos:u,lastPos:v,magnetize:w,animate:i,click:E};if(w){if(a.lastPos){i=a.lastPos.index!=a.pos.index;a.animate=i}s=N("getAnimateOptions",a);t(s)&&i&&(s=e.extend({},h.magnetizeOptions));s||(i=!1)}else if(i){s=N("getAnimateOptions",a);t(s)&&i&&(s=e.extend({},h.slideOptions));s||(i=!1)}i?e(l).animate({left:n+"%"},s):e(l).css("left",n+"%");C("prc",n);C("value",r);A("change",o);m=r}function M(e,t){T("moveToPrc",e);var n=b.findVal(e);e=b.findPrcByVal(n);O(e,n,t)}function _(e,t){T("moveToVal",e);var n=b.findPrc(e);e=b.findValByPrc(n);O(n,e,t)}function D(e,t){O(e,t,!1)}function P(e){M(e,!1)}function H(e){_(e,!1)}function B(e,t){O(e,t,!0)}function j(e){M(e,!0)}function F(e){_(e,!0)}function I(n){if(n.target===l||!n)return;var r=n.offsetX;t(r)&&(r=n.clientX-e(s).offset().left);var o=i.val2prc(r,e(s).width()),u=b.findVal(o);h.magnetize&&(o=b.findPrcByVal(u));var a={val:u};a.prc=w?b.findPrcByVal(u):o;a.index=b.findIndexByPrc(a.prc);A("slide",a,!1);E=!0;O(o,u,!0);E=!1}function q(e){var t=e.pos.prcX,n={val:b.findVal(t)};n.prc=w?b.findPrcByVal(val):t;n.index=b.findIndexByPrc(n.prc);A("start",n)}function R(e){var t=e.pos.prcX,n={val:b.findVal(t)};n.prc=w?b.findPrcByVal(val):t;n.index=b.findIndexByPrc(n.prc);if(n.val!=m){A("change",n,!1);m=n.val;g=!1}}function U(e){var t=e.pos.prcX;if(h.magnetize){w=!0;M(t,!1);w=!1}else{var n={val:b.findVal(t)};n.prc=t;n.index=b.findIndexByPrc(n.prc);if(n.val!=m){A("change",n);C("prc",n.prc);C("value",n.val);m=n.val;g=!1}}}var f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=0,g=!0,y={},b=new Set,w=!1,E=!1,S={start:"onStart",slide:"onSlide",change:"onChange"};f={set:function(e,t){if(e in f&&r(f[e],"function"))f[e](t);else if(e==="options"&&r(t,"object"))for(e in t)f.set(e,t[e])},get:function(e){return k(e)},log:function(e){return L("log",e,!1)},min:function(e){return L("min",e)},max:function(e){return L("max",e)},step:function(e){return L("step",e)},value:function(e){var n="value";if(t(e))return f.get(n);var i=!0,s=e;if(r(e,"object")){i=e.slide;s=e.value}i?F(s):H(s);g=!0;C(n)},val:this.value,prc:function(e){var n="prc";if(t(e))return f.get(n);var i=!0,s=e;if(r(e,"object")){i=e.slide;s=e.value}i?j(s):P(s)},items:function(e){var i="items";if(t(e))return f.get(i);var s,o,u=k("min"),a=k("max"),l=k("step"),c=e,h=!0;if(c&&c.length>1)try{h=r(c[0],"object");if(!h){s=s=c.length;o=(s-1)*l;for(;s--;){c[s]={prc:c[s],val:o};o-=l}}if(c[0].prc!==0||c[c.length-1].prc!==100){T("prcs goes from 0..100 from the first object to the last object");c=null}}catch(d){T("failed to build with given set of items")}if(c){b.setItems(c);if(h){p=new Array(c.length);for(s=c.length;n--;)p[s]={prc:c[s].prc,val:c[s].val}}else p=e.concat()}else{b.build(u,a,l);p=null}C(i,b.items());f.grid()&&f.grid(!0);return},grid:function(n){var r="grid";if(t(n))return f.get(r);e(s).find(".grid").remove();if(n){e(s).prepend('<div class="grid"></div>');var o=e(s).find(".grid"),u=function(e,t){return'<div class="'+e+'" style="position: absolute; left: '+t+'%"></div>'},a=f.adjustOffset()?e(l).width():0;o.css("right",a+"px");a=i.val2prc(e(l).width(),e(c).width())/2;e.each(b.items(),function(e,t){o.append(u("col",t.prc)).append(u("marker",t.prc+a))})}C(r,n);return},draggable:function(e){return d.enabled(e)},adjustOffset:function(n){var r="adjustOffset";if(t(n))return f.get(r);var i=n?e(l).width():0;e(c).css("right",i+"px");C(r,n);f.grid()&&f.grid(!0);return},magnetize:function(e){return L("magnetize",e,!1)},slideOnClick:function(n){var r="slideOnClick";if(t(n))return f.get(r);n&&!y[r]?e(s).on("click",I):y[r]&&e(s).off("click",I);y[r]=n;C(r,n);return},destroy:function(){e(s).data("slidestep",null);d.destroy();f.slideOnClick(!1);e(s).removeClass("slidestep");e(s).find(".rail").remove();e(s).find(".grid").remove();l=null;c=null;h=null;p=null;d=null;y=null;b=null;f=null}};x()}var t=function(e){return typeof e=="undefined"},r=function(e,t){return typeof e===t},i={};i.val2prc=function(e,t){return 100*e/t};i.prc2val=function(e,t){return e*t/100};var s={log:!1,grid:!1,min:0,max:100,step:1,value:0,items:null,draggable:!0,adjustOffset:!0,slideOnClick:!1,magnetize:!1,slideOptions:{easing:"swing",duration:400},magnetizeOptions:{easing:"linear",duration:100},getAnimateOptions:e.noop,onSlide:e.noop,onStart:e.noop,onChange:e.noop},o='<div class="rail"><a class="handle"></a></div>',u="console"in window;a.defaults=s;a.template=o;window.Slidestep=a;e.fn.slidestep=function(t){return this.each(function(){e(this).data("slidestep")?e(this).data("slidestep").set.apply(t,Array.prototype.slice.call(arguments,1)):new a(this,t)})}})(jQuery);