/**
 * jquery.slidestep - Slidestep ui control in jQuery
 * 
 * Written by
 * Cristobal Dabed (cristobal@dabed.org)
 *
 * Licensed under the MIT (MIT-LICENSE.txt).
 *
 * @author Cristobal Dabed
 * @version 0.1
 * 
 * Dependencies
 *  - jQuery 1.7 >= (http://jquery.com)
 **/
(function(){function r(){function u(e,t){var n=-1;for(var i=r.length;i--;)if(r[i][t]==e){n=i;break}return n}function a(t,n,i){if(r.length===0)return null;e(i)&&(i=!0);if(!o[n])return f(t,n,i);var s=0,u=r.length-1,a=r[s][n],l=r[u][n],c=(l-a)/u;if(t>=l)s=u;else if(t>a){s=Math.round((t-a)/c);if(!i){var h=t-r[s-1][n],p=r[s][n]-t;h===p&&s--}}return r[s]}function f(e,t,n){var i=0,s=r.length-1,o=r[i][t],u=r[s][t];if(e>=u)i=s;else if(e>o){var a,f;for(;s--;){o=r[s][t];if(e>=o&&e<=u){a=e-o;f=u-e;n?i=s+(a<f?0:1):i=s+(a<=f?0:1);break}u=o}}return r[i]}function l(e){var t=new Array(r.length),n=e==="all";for(var i=r.length;i--;)n?t[i]={prc:r[i].prc,val:r[i].val}:t[i]=r[i][e];return t}var r=[],i={},s={},o={prc:!0,val:!0};return{build:function(e,u,a){var f=n(e,u,a),l=0,c=100,h=t(c,f.length),p=n(l,c,h);p.length<f.length&&p.push(c);i={};s={};r=new Array(p.length);for(l=r.length;l--;){r[l]={prc:p[l],val:f[l]};i[f[l]]=p[l];s[p[l]]=f[l]}o.prc=!0;o.val=!0},values:function(){return l("val")},prcs:function(){return l("prc")},items:function(){return l("all")},setItems:function(e){o.prc=!0;o.val=!0;i={};s={};r=new Array(e.length);var t,n,u,a,f,l=0,c={},h=0,p={};for(t=r.length;t--;){n=e[t].prc;u=e[t].val;r[t]={prc:n,val:u};i[u]=n;s[n]=u;if(a&&o.prc){a-=n;if(!c[a]){l++;c[a]=!0}}if(f&&o.val){f-=u;if(!p[f]){h++;p[f]=!0}}a=n;f=u}o.prc=l<=1;o.val=h<=1},findVal:function(e,t){var n=a(e,"prc",t);return n?n.val:null},findValByPrc:function(e){return s.hasOwnProperty(e)?s[e]:null},findIndexByPrc:function(e){return u(e,"prc")},findPrc:function(e,t){var n=a(e,"val",t);return n?n.prc:null},findPrcByVal:function(e){return i.hasOwnProperty(e)?i[e]:null},findIndexByVal:function(e){return u(e,"val")}}}var e=function(e){return typeof e=="undefined"},t=function(e,t){return Math.round(e/(t-1))},n=function(t,n,r){e(r)&&(r=1);var i=[];for(var s=t;s<=n;s+=r)i.push(s);return i};window.Set=r})();(function(e){function u(u,a,f){function x(t){var n=o[t];if(l[n]){var r={event:m,pos:e.extend({},d)};l[n](r)}}function T(t,r){if(d.x!=t){var i=n(t,e(a).width()),s=0;l.usePercentage?e(u).css("left",i+"%"):e(u).css("left",t+"px");d.y=r;d.x=t;d.prcX=i;d.prcY=s;x("change");return!0}return!1}function N(r){if(h)return;var s=0,o=0,f=e(u).offset(),c=e(u).position();if(i){var g=r.originalEvent.changedTouches[0],b=e(u).width(),T=e(u).height();s=g.clientX-f.left;if(t(s)||s>b||s<0)s=b/2;o=g.clientX-f.top;if(t(o)||o>T||o<0)o=T/2;v.x=g.pageX-c.left;v.y=g.pageY-c.top}else{s=r.offsetX;t(f.x)&&(s=r.clientX-f.left);o=r.offsetY;t(o)&&(o=r.clientY-f.top)}p.x=s;p.y=o;d.x=c.left;d.y=c.top;d.prcX=n(d.x,e(a).width());d.prcY=n(d.y,e(a).height());y=e(a).width();w=e(a).height();E=l.adjustOffset?p.x:0;S=l.adjustOffset?p.y:0;m=r;x("start");h=!0;return!1}function C(e){h&&x("end");h=!1;m=null}function k(t){if(!h||!m||!t)return!0;var n=0,r=0;if(i){var s=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];n=s.pageX-(v.x+E)}else{var o=e(a).offset();n=t.clientX-(o.left+E)}n<g?n=g:n>y&&(n=y);m=t;if(T(n,r)){y=e(a).width();w=e(a).height()}return!1}var l=jQuery.extend({},r,f),c={},h=!1,p={x:0,y:0},d={x:0,y:0,prcX:0,prxY:0},v={x:0,y:0},m=null,g=0,y=0,b=0,w=0,E=0,S=0;return{enabled:function(n){if(t(n))return c.enabled;if(n&&!c.enabled){e(u).on(s.down,N);e(u).on(s.up,C);e(u).on(s.move,k);e(u).on(s.cancel,C);e(document).on(s.up,C);e(document).on(s.move,k)}else{e(u).off(s.down,N);e(u).off(s.up,C);e(u).off(s.move,k);e(u).off(s.cancel,handleMouseCancel);e(document).off(s.up,C);e(document).off(s.move,k)}c.enabled=n},dragging:function(){return h},destroy:function(){this.enabled(!1);c=null;d=null;p=null;v=null;m=null}}}var t=function(e){return typeof e=="undefined"},n=function(e,t){return 100*e/t},r={adjustOffset:!0,usePercentage:!0,updatePos:!0,onStart:e.noop,onChange:e.noop,onEnd:e.noop},i=/android|iphone|ipad|mobile/i.test(navigator.userAgent),s={click:i?"touchstart":"click",down:i?"touchstart":"mousedown",move:i?"touchmove":"mousemove",up:i?"touchend":"mouseup",cancel:"touchcancel"},o={change:"onChange",start:"onStart",end:"onEnd"};u.defaults=r;window.Draggable=u})(jQuery);(function(e){function u(i,s){function S(){c=e.extend({},u.defaults,s);e(i).addClass("slidestep").append(u.template);l=e(i).find(".rail").get(0);f=e(i).find(".rail .handle").get(0);e(f).addClass("unselectable").attr("unselectable","on");p=new Draggable(f,l,{onChange:q,onStart:I,onEnd:R});e.each(["adjustOffset","items","grid","log","draggable","slideOnClick"],function(e,t){c.hasOwnProperty(t)&&a.set(t,c[t])});P(c.value);e(i).data("slidestep",a)}function x(){if(c.log&&o)try{console.log.apply(console,arguments)}catch(e){}}function T(e,t){if(c[e]&&n(c[e],"function"))return c[e](t);return}function N(e,t){c[e]=t}function C(t){if(t==="options")return e.extend({},c);if(!c.hasOwnProperty(t))return null;var r=c[t];n(r,"object")&&!n(r.concat,"function")&&(r=e.extend({},r));return r}function k(e,n,r){if(t(n))return a.get(e);N(e,n);t(r)&&(r=!0);if(r){a.setItems(h);a.grid()&&a.grid(!0)}return}function L(n,r,i){t(i)&&(i=!0);var s={pos:r,lastPos:d};i&&(s.pos=e.extend({},s.pos));T(E[n],s);i&&(d=r)}function A(n,r,i){x("moveTo",n,r,i);var s=null,o={val:r,prc:n,index:y.findIndexByPrc(n)},u={val:r,prc:n,index:o.index},a={pos:u,lastPos:d,magnetize:b,animate:i,click:w};if(b){if(a.lastPos){i=a.lastPos.index!=a.pos.index;a.animate=i}s=T("getAnimateOptions",a);t(s)&&i&&(s=e.extend({},c.magnetizeOptions));s||(i=!1)}else if(i){s=T("getAnimateOptions",a);t(s)&&i&&(s=e.extend({},c.slideOptions));s||(i=!1)}i?e(f).animate({left:n+"%"},s):e(f).css("left",n+"%");N("prc",n);N("value",r);L("change",o);v=r}function O(e,t){x("moveToPrc",e);var n=y.findVal(e);e=y.findPrcByVal(n);A(e,n,t)}function M(e,t){x("moveToVal",e);var n=y.findPrc(e);e=y.findValByPrc(n);A(n,e,t)}function _(e,t){A(e,t,!1)}function D(e){O(e,!1)}function P(e){M(e,!1)}function H(e,t){A(e,t,!0)}function B(e){O(e,!0)}function j(e){M(e,!0)}function F(n){if(n.target===f||!n)return;var s=n.offsetX;t(s)&&(s=n.clientX-e(i).offset().left);var o=r.val2prc(s,e(i).width()),u=y.findVal(o);c.magnetize&&(o=y.findPrcByVal(u));var a={val:u};a.prc=b?y.findPrcByVal(u):o;a.index=y.findIndexByPrc(a.prc);L("slide",a,!1);w=!0;A(o,u,!0);w=!1}function I(e){var t=e.pos.prcX,n={val:y.findVal(t)};n.prc=b?y.findPrcByVal(val):t;n.index=y.findIndexByPrc(n.prc);L("start",n)}function q(e){var t=e.pos.prcX,n={val:y.findVal(t)};n.prc=b?y.findPrcByVal(val):t;n.index=y.findIndexByPrc(n.prc);if(n.val!=v){L("change",n,!1);v=n.val;m=!1}}function R(e){var t=e.pos.prcX;if(c.magnetize){b=!0;O(t,!1);b=!1}else{var n={val:y.findVal(t)};n.prc=t;n.index=y.findIndexByPrc(n.prc);if(n.val!=v){L("change",n);N("prc",n.prc);N("value",n.val);v=n.val;m=!1}}}var a=null,f=null,l=null,c=null,h=null,p=null,d=null,v=0,m=!0,g={},y=new Set,b=!1,w=!1,E={start:"onStart",slide:"onSlide",change:"onChange"};a={set:function(e,t){if(e in a&&n(a[e],"function"))a[e](t);else if(e==="options"&&n(t,"object"))for(e in t)a.set(e,t[e])},get:function(e){return C(e)},log:function(e){return k("log",e,!1)},min:function(e){return k("min",e)},max:function(e){return k("max",e)},step:function(e){return k("step",e)},value:function(e){var r="value";if(t(e))return a.get(r);var i=!0,s=e;if(n(e,"object")){i=e.slide;s=e.value}i?j(s):P(s);m=!0;N(r)},val:this.value,prc:function(e){var r="prc";if(t(e))return a.get(r);var i=!0,s=e;if(n(e,"object")){i=e.slide;s=e.value}i?B(s):D(s)},items:function(e){var r="items";if(t(e))return a.get(r);var i,s,o=C("min"),u=C("max"),f=C("step"),l=e,c=!0;if(l&&l.length>1)try{c=n(l[0],"object");if(!c){i=i=l.length;s=(i-1)*f;for(;i--;){l[i]={prc:l[i],val:s};s-=f}}if(l[0].prc!==0||l[l.length-1].prc!==100){x("prcs goes from 0..100 from the first object to the last object");l=null}}catch(p){x("failed to build with given set of items")}if(l){y.setItems(l);if(c){h=new Array(l.length);for(i=l.length;i--;)h[i]={prc:l[i].prc,val:l[i].val}}else h=e.concat()}else{y.build(o,u,f);h=null}N(r,y.items());a.grid()&&a.grid(!0);return},grid:function(n){var s="grid";if(t(n))return a.get(s);e(i).find(".grid").remove();if(n){e(i).prepend('<div class="grid"></div>');var o=e(i).find(".grid"),u=function(e,t){return'<div class="'+e+'" style="position: absolute; left: '+t+'%"></div>'},c=a.adjustOffset()?e(f).width():0;o.css("right",c+"px");c=r.val2prc(e(f).width(),e(l).width())/2;e.each(y.items(),function(e,t){o.append(u("col",t.prc)).append(u("marker",t.prc+c))})}N(s,n);return},draggable:function(e){return p.enabled(e)},adjustOffset:function(n){var r="adjustOffset";if(t(n))return a.get(r);var i=n?e(f).width():0;e(l).css("right",i+"px");N(r,n);a.grid()&&a.grid(!0);return},magnetize:function(e){return k("magnetize",e,!1)},slideOnClick:function(n){var r="slideOnClick";if(t(n))return a.get(r);n&&!g[r]?e(i).on("click",F):g[r]&&e(i).off("click",F);g[r]=n;N(r,n);return},destroy:function(){e(i).data("slidestep",null);p.destroy();a.slideOnClick(!1);e(i).removeClass("slidestep");e(i).find(".rail").remove();e(i).find(".grid").remove();f=null;l=null;c=null;h=null;p=null;g=null;y=null;a=null}};S()}var t=function(e){return typeof e=="undefined"},n=function(e,t){return typeof e===t},r={};r.val2prc=function(e,t){return 100*e/t};r.prc2val=function(e,t){return e*t/100};var i={log:!1,grid:!1,min:0,max:100,step:1,value:0,items:null,draggable:!0,adjustOffset:!0,slideOnClick:!1,magnetize:!1,slideOptions:{easing:"swing",duration:400},magnetizeOptions:{easing:"linear",duration:100},getAnimateOptions:e.noop,onSlide:e.noop,onStart:e.noop,onChange:e.noop},s='<div class="rail"><a class="handle"></a></div>',o="console"in window;u.defaults=i;u.template=s;window.Slidestep=u;e.fn.slidestep=function(t){return this.each(function(){e(this).data("slidestep")?e(this).data("slidestep").set.apply(t,Array.prototype.slice.call(arguments,1)):new u(this,t)})}})(jQuery);